{
  "$defs": {
    "LineScope": {
      "description": "Scope by line range",
      "properties": {
        "start_line": {
          "description": "Start line number (1-based, inclusive)",
          "minimum": 1,
          "title": "Start Line",
          "type": "integer"
        },
        "end_line": {
          "description": "End line number (1-based, exclusive). When set to 0, means till EOF.",
          "title": "End Line",
          "type": "integer"
        }
      },
      "required": [
        "start_line",
        "end_line"
      ],
      "title": "LineScope",
      "type": "object"
    },
    "Locate": {
      "description": "Two-stage location: scope \u2192 find.\n\nResolution rules:\n    1. SymbolScope without find: symbol declaration position (for references, rename)\n    2. With find containing marker: marker position\n    3. With find only: start of matched text\n    4. No scope + find: search entire file\n\nMarker Detection:\n    The marker is automatically detected using nested bracket notation:\n    - <|> (single level)\n    - <<|>> (double level) if <|> appears more than once\n    ... and so on\n\n    The marker with the deepest nesting level that appears exactly once\n    is chosen as the position marker.\n\nExamples:\n    # Symbol declaration\n    Locate(file_path=\"foo.py\", scope=SymbolScope(symbol_path=[\"MyClass\"]))\n\n    # Completion trigger point - basic marker\n    Locate(file_path=\"foo.py\", find=\"self.<|>\")\n\n    # When <|> exists in source, use deeper nesting\n    Locate(file_path=\"foo.py\", find=\"x = <|> + y <<|>> z\")\n    # Will use <<|>> as the position marker\n\n    # Specific location in function\n    Locate(\n        file_path=\"foo.py\",\n        scope=SymbolScope(symbol_path=[\"process\"]),\n        find=\"return <|>result\"\n    )",
      "properties": {
        "file_path": {
          "format": "path",
          "title": "File Path",
          "type": "string"
        },
        "scope": {
          "anyOf": [
            {
              "$ref": "#/$defs/LineScope"
            },
            {
              "$ref": "#/$defs/SymbolScope"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Scope"
        },
        "find": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Find"
        }
      },
      "required": [
        "file_path"
      ],
      "title": "Locate",
      "type": "object"
    },
    "Location": {
      "properties": {
        "file_path": {
          "format": "path",
          "title": "File Path",
          "type": "string"
        },
        "range": {
          "$ref": "#/$defs/Range"
        }
      },
      "required": [
        "file_path",
        "range"
      ],
      "title": "Location",
      "type": "object"
    },
    "Position": {
      "description": "Represents a specific position in a file using line and character numbers.\n\nNote: Line and character are 1-based indices. 0-based indices are used in LSP, so conversion is needed when interfacing with LSP.",
      "properties": {
        "line": {
          "minimum": 1,
          "title": "Line",
          "type": "integer"
        },
        "character": {
          "minimum": 1,
          "title": "Character",
          "type": "integer"
        }
      },
      "required": [
        "line",
        "character"
      ],
      "title": "Position",
      "type": "object"
    },
    "Range": {
      "properties": {
        "start": {
          "$ref": "#/$defs/Position"
        },
        "end": {
          "$ref": "#/$defs/Position"
        }
      },
      "required": [
        "start",
        "end"
      ],
      "title": "Range",
      "type": "object"
    },
    "ReferenceItem": {
      "properties": {
        "location": {
          "$ref": "#/$defs/Location"
        },
        "code": {
          "description": "Surrounding code snippet",
          "title": "Code",
          "type": "string"
        },
        "symbol": {
          "anyOf": [
            {
              "$ref": "#/$defs/SymbolDetailInfo"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "description": "The symbol containing this reference"
        }
      },
      "required": [
        "location",
        "code"
      ],
      "title": "ReferenceItem",
      "type": "object"
    },
    "ReferenceRequest": {
      "description": "Finds all references (usages) or concrete implementations of a symbol.\n\nUse this to see where a function, class, or variable is used across the codebase,\nor to find how an interface is implemented in subclasses.",
      "properties": {
        "locate": {
          "$ref": "#/$defs/Locate"
        },
        "max_items": {
          "anyOf": [
            {
              "type": "integer"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Max Items"
        },
        "start_index": {
          "default": 0,
          "title": "Start Index",
          "type": "integer"
        },
        "pagination_id": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Pagination Id"
        },
        "mode": {
          "default": "references",
          "enum": [
            "references",
            "implementations"
          ],
          "title": "Mode",
          "type": "string"
        },
        "context_lines": {
          "default": 2,
          "title": "Context Lines",
          "type": "integer"
        }
      },
      "required": [
        "locate"
      ],
      "title": "ReferenceRequest",
      "type": "object"
    },
    "SymbolDetailInfo": {
      "properties": {
        "file_path": {
          "format": "path",
          "title": "File Path",
          "type": "string"
        },
        "name": {
          "title": "Name",
          "type": "string"
        },
        "path": {
          "items": {
            "type": "string"
          },
          "title": "Path",
          "type": "array"
        },
        "kind": {
          "$ref": "#/$defs/SymbolKind"
        },
        "range": {
          "anyOf": [
            {
              "$ref": "#/$defs/Range"
            },
            {
              "type": "null"
            }
          ],
          "default": null
        },
        "detail": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Detail"
        },
        "hover": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ],
          "default": null,
          "title": "Hover"
        }
      },
      "required": [
        "file_path",
        "name",
        "path",
        "kind"
      ],
      "title": "SymbolDetailInfo",
      "type": "object"
    },
    "SymbolKind": {
      "enum": [
        "file",
        "module",
        "namespace",
        "package",
        "class",
        "method",
        "property",
        "field",
        "constructor",
        "enum",
        "interface",
        "function",
        "variable",
        "constant",
        "string",
        "number",
        "boolean",
        "array",
        "object",
        "key",
        "null",
        "enumMember",
        "struct",
        "event",
        "operator",
        "typeParameter"
      ],
      "title": "SymbolKind",
      "type": "string"
    },
    "SymbolScope": {
      "description": "Scope by symbol, also serves as declaration locator when find is omitted",
      "properties": {
        "symbol_path": {
          "items": {
            "type": "string"
          },
          "title": "Symbol Path",
          "type": "array"
        }
      },
      "required": [
        "symbol_path"
      ],
      "title": "SymbolScope",
      "type": "object"
    }
  },
  "markdown": "\n# {{ request.mode | capitalize }} Found\n\n{% if total != nil -%}\nTotal {{ request.mode }}: {{ total }} | Showing: {{ items.size }}{% if max_items != nil %} (Offset: {{ start_index }}, Limit: {{ max_items }}){% endif %}\n{%- endif %}\n\n{% if items.size == 0 -%}\nNo {{ request.mode }} found.\n{%- else -%}\n{%- for item in items -%}\n### `{{ item.location.file_path }}:{{ item.location.range.start.line }}`\n{%- if item.symbol != nil %}\nIn `{{ item.symbol.path | join: \".\" }}` (`{{ item.symbol.kind }}`)\n{%- endif %}\n\n```{{ item.location.file_path.suffix | remove_first: \".\" }}\n{{ item.code }}\n```\n\n{% endfor -%}\n\n{% if has_more -%}\n---\n> [!TIP]\n> More {{ request.mode }} available.\n> To see more, use: `pagination_id=\"{{ pagination_id }}\"`, `start_index={{ start_index | plus: items.size }}`\n{%- endif %}\n{%- endif %}\n",
  "properties": {
    "start_index": {
      "title": "Start Index",
      "type": "integer"
    },
    "max_items": {
      "title": "Max Items",
      "type": "integer"
    },
    "total": {
      "title": "Total",
      "type": "integer"
    },
    "has_more": {
      "title": "Has More",
      "type": "boolean"
    },
    "pagination_id": {
      "title": "Pagination Id",
      "type": "string"
    },
    "request": {
      "$ref": "#/$defs/ReferenceRequest"
    },
    "items": {
      "items": {
        "$ref": "#/$defs/ReferenceItem"
      },
      "title": "Items",
      "type": "array"
    }
  },
  "required": [
    "start_index",
    "max_items",
    "total",
    "has_more",
    "pagination_id",
    "request",
    "items"
  ],
  "title": "ReferenceResponse",
  "type": "object"
}
