import { z } from "zod";

export const TypeHierarchyResponse = z.object({ "root": z.object({ "id": z.string(), "name": z.string(), "kind": z.string(), "file_path": z.string(), "range_start": z.object({ "line": z.number().int(), "character": z.number().int() }), "detail": z.union([z.string(), z.null()]).default(null) }), "nodes": z.record(z.object({ "id": z.string(), "name": z.string(), "kind": z.string(), "file_path": z.string(), "range_start": z.object({ "line": z.number().int(), "character": z.number().int() }), "detail": z.union([z.string(), z.null()]).default(null) })), "edges_up": z.record(z.array(z.object({ "from_node_id": z.string(), "to_node_id": z.string(), "relationship": z.enum(["extends","implements"]) }))), "edges_down": z.record(z.array(z.object({ "from_node_id": z.string(), "to_node_id": z.string(), "relationship": z.enum(["extends","implements"]) }))), "direction": z.string(), "depth": z.number().int() });

export const TypeHierarchyResponseTemplates = {
  "markdown": "\n### Type Hierarchy for `{{ root.name }}` (Depth: {{ depth }}, Direction: {{ direction }})\n\n{%- macro render_tree(node_id, current_depth, visited, dir_label) %}\n  {%- if current_depth <= depth %}\n    {%- set node = nodes[node_id] %}\n    {%- set edges_to_show = edges_down[node_id] if dir_label == \"Subtypes\" else edges_up[node_id] %}\n{{ \"  \" * current_depth }}- **{{ node.name }}** (`{{ node.kind }}`) {% if node.detail %}[{{ node.detail }}]{% endif %} in `{{ node.file_path }}`\n    {%- if node_id in visited %} (recursive cycle)\n    {%- else %}\n      {%- do visited.append(node_id) %}\n      {%- for edge in edges_to_show %}\n        {%- set target_id = edge.to_node_id if dir_label == \"Subtypes\" else edge.from_node_id %}\n{{ render_tree(target_id, current_depth + 1, visited, dir_label) }}\n      {%- endfor %}\n    {%- endif %}\n  {%- endif %}\n{%- endmacro %}\n\n{% if direction in [\"supertypes\", \"both\"] %}\n#### Supertypes (Parents/Base Classes)\n{{ render_tree(root.id, 0, [], \"Supertypes\") }}\n{% endif %}\n\n{% if direction in [\"subtypes\", \"both\"] %}\n#### Subtypes (Children/Implementations)\n{{ render_tree(root.id, 0, [], \"Subtypes\") }}\n{% endif %}\n\n---\n> [!NOTE]\n> Tree is truncated at depth {{ depth }}. Use `depth` parameter to explore further.\n"
} as const;
